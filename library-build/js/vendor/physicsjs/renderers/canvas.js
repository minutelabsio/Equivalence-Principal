/**
 * PhysicsJS v1.0.0-rc1 - 2014-03-23
 * A modular, extendable, and easy-to-use physics engine for javascript
 * http://wellcaffeinated.net/PhysicsJS
 *
 * Copyright (c) 2014 Jasper Palfree <jasper@wellcaffeinated.net>
 * Licensed MIT
 */

(function(e,t){typeof define=="function"&&define.amd?define(["physicsjs"],t):typeof exports=="object"?module.exports=t.apply(e,["physicsjs"].map(require)):t.call(e,e.Physics)})(this,function(e){return e.renderer("canvas",function(t){if(!document)return{};var n=Math.PI*2,r=function(e,t){var n=document.createElement(e||"div");return t&&(n.innerHTML=t),n},i={debug:!1,metaEl:null,styles:{point:"rgba(80, 50, 100, 0.7)",circle:{strokeStyle:"rgba(70, 50, 100, 0.7)",lineWidth:1,fillStyle:"rgba(44, 105, 44, 0.7)",angleIndicator:"rgba(69, 51, 78, 0.7)"},"convex-polygon":{strokeStyle:"rgba(80, 50, 100, 0.7)",lineWidth:1,fillStyle:"rgba(114, 105, 124, 0.7)",angleIndicator:"rgba(69, 51, 78, 0.7)"}},offset:{x:0,y:0}},s=function(t,n){return e.util.isPlainObject(n)?e.util.extend({},t,n,s):n!==undefined?n:t};return{init:function(n){var o=this;t.init.call(this,n),this.options=e.util.extend({},i,this.options,s),this.options.offset=e.vector(this.options.offset),this.hiddenCanvas=document.createElement("canvas"),this.hiddenCanvas.width=this.hiddenCanvas.height=100;if(!this.hiddenCanvas.getContext)throw"Canvas not supported";this.hiddenCtx=this.hiddenCanvas.getContext("2d");var u=this.el;u.nodeName.toUpperCase()!=="CANVAS"&&(u=document.createElement("canvas"),this.el.appendChild(u),typeof this.options.el=="string"&&this.el===document.body&&(u.id=this.options.el),this.el=u),u.width=this.options.width,u.height=this.options.height,this.ctx=u.getContext("2d"),this.els={};if(this.options.meta){var a=this.options.metaEl||r();a.className="pjs-meta",this.els.fps=r("span"),this.els.ipf=r("span"),a.appendChild(r("span","fps: ")),a.appendChild(this.els.fps),a.appendChild(r("br")),a.appendChild(r("span","ipf: ")),a.appendChild(this.els.ipf),u.parentNode.insertBefore(a,u)}},setStyle:function(t,n){n=n||this.ctx,e.util.isObject(t)?(n.lineWidth=t.lineWidth,n.strokeStyle=t.lineWidth?t.strokeStyle:"rgba(0,0,0,0)",n.fillStyle=t.fillStyle):(n.fillStyle=n.strokeStyle=t,n.lineWidth=1)},drawCircle:function(e,t,r,i,s){s=s||this.ctx,s.beginPath(),this.setStyle(i,s),s.arc(e,t,r,0,n,!1),s.closePath(),s.stroke(),s.fill()},drawPolygon:function(e,t,n){var r=e[0],i=r.x===undefined?r.get(0):r.x,s=r.y===undefined?r.get(1):r.y,o=e.length;n=n||this.ctx,n.beginPath(),this.setStyle(t,n),n.moveTo(i,s);for(var u=1;u<o;++u)r=e[u],i=r.x===undefined?r.get(0):r.x,s=r.y===undefined?r.get(1):r.y,n.lineTo(i,s);o>2&&n.closePath(),n.stroke(),n.fill()},drawRect:function(e,t,n,r,i,s){var o=n*.5,u=r*.5;s=s||this.ctx,this.setStyle(i,s),s.beginPath(),s.rect(e-o,t-u,n,r),s.closePath(),s.stroke(),s.fill()},drawLine:function(e,t,n,r){var i=e.x===undefined?e.get(0):e.x,s=e.y===undefined?e.get(1):e.y;r=r||this.ctx,r.beginPath(),this.setStyle(n,r),r.moveTo(i,s),i=t.x===undefined?t.get(0):t.x,s=t.y===undefined?t.get(1):t.y,r.lineTo(i,s),r.stroke(),r.fill()},createView:function(e,t){var n,r=e.aabb(),i=r.halfWidth+Math.abs(r.pos.x),s=r.halfHeight+Math.abs(r.pos.y),o=i+1,u=s+1,a=this.hiddenCtx,f=this.hiddenCanvas,l=e.name;return t=t||this.options.styles[l],t.src?(n=new Image,n.src=t.src,t.width&&(n.width=t.width),t.height&&(n.height=t.height),n):(o+=t.lineWidth|0,u+=t.lineWidth|0,f.width=2*i+2+(2*t.lineWidth|0),f.height=2*s+2+(2*t.lineWidth|0),a.save(),a.translate(o,u),l==="circle"?this.drawCircle(0,0,e.radius,t,a):l==="convex-polygon"&&this.drawPolygon(e.vertices,t,a),t.angleIndicator&&(a.beginPath(),this.setStyle(t.angleIndicator,a),a.moveTo(0,0),a.lineTo(i,0),a.closePath(),a.stroke()),a.restore(),n=new Image(f.width,f.height),n.src=f.toDataURL("image/png"),n)},drawMeta:function(e){this.els.fps.innerHTML=e.fps.toFixed(2),this.els.ipf.innerHTML=e.ipf},beforeRender:function(){this.ctx.clearRect(0,0,this.el.width,this.el.height)},drawBody:function(e,t,n,r){var i=e.state.pos,s=e.aabb();r=r||this.options.offset,n=n||this.ctx,n.save(),n.translate(i.get(0)+r.get(0),i.get(1)+r.get(1)),n.rotate(e.state.angular.pos),n.drawImage(t,-t.width/2,-t.height/2),n.restore(),this.options.debug&&(this.drawRect(s.pos.x,s.pos.y,2*s.x,2*s.y,"rgba(0, 0, 255, 0.3)"),e._debugView=e._debugView||this.createView(e.geometry,"rgba(255, 0, 0, 0.5)"),n.save(),n.translate(i.get(0)+r.get(0),i.get(1)+r.get(1)),n.rotate(e.state.angular.pos),n.drawImage(e._debugView,-e._debugView.width*.5,-e._debugView.height*.5),n.restore())}}}),e});